---
- name: ensure chocolatey is installed
  chocolatey.chocolatey.win_chocolatey:
    name:
      - chocolatey
    state: present

- name: install geforce-game-ready-driver
  win_chocolatey:
    name: nvidia-display-driver
    version: '{{ desired_nvda_version }}'
    state: present
    # force: true
    params:
      '/NVApp /NoAudio /NoUSBC'
      # '/NoAudio /NoUSBC'

- name: install firefox
  block:

  - name: install package
    win_chocolatey:
      name: firefox
      state: present
      params:
        '/NoDesktopShortcut'

  - name: ensure distribution folder exists
    win_file:
      path: C:\Program Files\Mozilla Firefox\distribution
      state: directory

  - name: deploy policies.json
    win_copy:
      content: |
        {
          "policies": {
            "SearchEngines": {
              "Default": "DuckDuckGo"
            },
            "Bookmarks": [
              {
                "Title": "Grok",
                "URL": "https://grok.com"
              },
              {
                "Title": "ChatGPT",
                "URL": "https://chat.openai.com"
              }
            ],
            "Extensions": {
              "Install": [
                "https://addons.mozilla.org/firefox/downloads/latest/ublock-origin/latest.xpi"
              ],
              "Locked": ["ublock-origin@raymondhill.net"]
            },
            "ExtensionSettings": {
              "ublock-origin@raymondhill.net": {
                "install_sources": ["https://addons.mozilla.org/"],
                "run_in_private_windows": true
              }
            }
          }
        }
      dest: "C:\\Program Files\\Mozilla Firefox\\distribution\\policies.json"
      force: yes

- name: install blender
  win_chocolatey:
    name: blender
    version: '{{ desired_blender_version }}'
    state: present

- name: install audacity
  win_chocolatey:
    name: audacity
    version: '{{ desired_audacity_version }}'
    state: present

- name: install unity hub
  win_chocolatey:
    name: unity-hub
    state: present

- name: install visual studio community 2022
  win_chocolatey:
    name: visualstudio2022community
    # package_params: >
    #   --add Microsoft.VisualStudio.Workload.ManagedGame
    #   --add Microsoft.VisualStudio.Workload.NativeGame
    #   --add Microsoft.VisualStudio.Workload.NetWeb
    state: present

- name: install wsl2
  win_chocolatey:
    name: wsl2
    state: present
  register: wsl2_result 

- name: reboot
  win_reboot:
  when: wsl2_result.changed

- name: install ubuntu wsl
  win_chocolatey:
    name: wsl-ubuntu-2004
    state: present
